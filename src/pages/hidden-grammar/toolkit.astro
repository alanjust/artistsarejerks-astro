---
import HiddenGrammarLayout from '../../layouts/HiddenGrammarLayout.astro';
import { toolkitBuckets } from '../../data/toolkit-modes.js';

// Pre-process buckets in frontmatter where TypeScript is safe
const processedBuckets = toolkitBuckets.map((bucket: any) => {
  if (bucket.id !== 'stress-testing') {
    return { ...bucket, isLenses: false, lensCategories: null };
  }

  // Group External Lenses by category
  const cats: { [key: string]: any[] } = {};
  for (const mode of bucket.modes) {
    const cat = mode.category || 'Other';
    if (!cats[cat]) cats[cat] = [];
    cats[cat].push(mode);
  }

  return { ...bucket, isLenses: true, lensCategories: Object.entries(cats) };
});

function modeHref(mode: any): string {
  return `/hidden-grammar/toolkit/${mode.id}`;
}
---

<HiddenGrammarLayout title="Art Lab — The Toolkit">
  <div class="toolkit-page">

    <!-- ── PAGE HEADER ─────────────────────────────────────────── -->
    <header class="toolkit-header">
      <div class="toolkit-eyebrow">Art Lab</div>
      <h1 class="toolkit-title">The Toolkit</h1>
      <p class="toolkit-subtitle">
        Pick what you're trying to do. Each tool gives you a structured way to look — grounded in what's visible, not in what the art world has decided something means.
      </p>
      <p class="toolkit-note">
        <span class="badge badge--live">Live</span> tools run in the AI analyzer now.
        <span class="badge badge--soon">Coming soon</span> tools are in development.
      </p>
    </header>

    <!-- ── BUCKET NAV ──────────────────────────────────────────── -->
    <nav class="bucket-nav" aria-label="Jump to section">
      {processedBuckets.map((bucket: any) => (
        <a href={`#${bucket.id}`} class="bucket-nav-pill">
          {bucket.label}
        </a>
      ))}
    </nav>

    <!-- ── BUCKETS ─────────────────────────────────────────────── -->
    <div class="buckets">
      {processedBuckets.map((bucket: any) => (
        <section class="bucket" id={bucket.id}>
          <div class="bucket-header">
            <h2 class="bucket-title">{bucket.label}</h2>
            <p class="bucket-description">{bucket.description}</p>
          </div>

          {bucket.isLenses ? (
            <div class="lens-categories">
              {bucket.lensCategories.map(([cat, modes]: [string, any[]]) => (
                <div class="lens-category">
                  <h3 class="lens-category-label">{cat}</h3>
                  <div class="cards-grid">
                    {modes.map((mode: any) => (
                      <a href={modeHref(mode)} class={`mode-card ${mode.status === 'coming-soon' ? 'mode-card--soon' : ''}`}>
                        <div class="mode-card-top">
                          <span class={`badge ${mode.status === 'live' ? 'badge--live' : 'badge--soon'}`}>
                            {mode.status === 'live' ? 'Live' : 'Coming soon'}
                          </span>
                          {mode.note && <span class="mode-card-note">{mode.note}</span>}
                        </div>
                        <h3 class="mode-card-label">{mode.label}</h3>
                        <p class="mode-card-tagline">{mode.tagline}</p>
                        <div class="mode-card-footer">
                          <span class="mode-card-phase">{mode.phase}</span>
                          <span class="mode-card-arrow">→</span>
                        </div>
                      </a>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div class="cards-grid">
              {bucket.modes.map((mode: any) => (
                <a href={modeHref(mode)} class={`mode-card ${mode.status === 'coming-soon' ? 'mode-card--soon' : ''}`}>
                  <div class="mode-card-top">
                    <span class={`badge ${mode.status === 'live' ? 'badge--live' : 'badge--soon'}`}>
                      {mode.status === 'live' ? 'Live' : 'Coming soon'}
                    </span>
                    {mode.note && <span class="mode-card-note">{mode.note}</span>}
                  </div>
                  <h3 class="mode-card-label">{mode.label}</h3>
                  <p class="mode-card-tagline">{mode.tagline}</p>
                  <div class="mode-card-footer">
                    <span class="mode-card-phase">{mode.phase}</span>
                    <span class="mode-card-arrow">→</span>
                  </div>
                </a>
              ))}
            </div>
          )}
        </section>
      ))}
    </div>

    <!-- ── FOOTER CTA ──────────────────────────────────────────── -->
    <div class="toolkit-cta">
      <p>Ready to start?</p>
      <a href="/hidden-grammar/ai-analyze" class="hg-btn hg-btn--primary">
        Open the AI Analyzer →
      </a>
    </div>

  </div>
</HiddenGrammarLayout>

<style>
  .toolkit-page {
    max-width: 1100px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem 4rem;
  }

  .toolkit-header {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid #e2e8f0;
  }

  .toolkit-eyebrow {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #4f46e5;
    margin-bottom: 0.5rem;
  }

  .toolkit-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: #0f172a;
    margin: 0 0 0.75rem;
    line-height: 1.1;
  }

  .toolkit-subtitle {
    font-size: 1.125rem;
    color: #475569;
    max-width: 640px;
    line-height: 1.65;
    margin: 0 0 1rem;
  }

  .toolkit-note {
    font-size: 0.875rem;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    flex-wrap: wrap;
  }

  .badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 0.2rem 0.55rem;
    border-radius: 4px;
    white-space: nowrap;
  }

  .badge--live { background: #dcfce7; color: #166534; }
  .badge--soon { background: #f1f5f9; color: #64748b; }

  .bucket-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 3rem;
  }

  .bucket-nav-pill {
    font-size: 0.8125rem;
    font-weight: 600;
    color: #4f46e5;
    background: #eef2ff;
    border: 1.5px solid #c7d2fe;
    border-radius: 20px;
    padding: 0.35rem 0.9rem;
    text-decoration: none;
    transition: all 0.15s ease;
    white-space: nowrap;
  }

  .bucket-nav-pill:hover {
    background: #4f46e5;
    color: #ffffff;
    border-color: #4f46e5;
  }

  .buckets {
    display: flex;
    flex-direction: column;
    gap: 4rem;
  }

  .bucket {
    scroll-margin-top: 5rem;
  }

  .bucket-header {
    margin-bottom: 1.75rem;
  }

  .bucket-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 0.5rem;
  }

  .bucket-description {
    font-size: 0.9375rem;
    color: #64748b;
    max-width: 600px;
    line-height: 1.6;
    margin: 0;
  }

  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1rem;
  }

  .mode-card {
    display: flex;
    flex-direction: column;
    background: #ffffff;
    border: 1.5px solid #e2e8f0;
    border-radius: 10px;
    padding: 1.25rem;
    text-decoration: none;
    transition: all 0.18s ease;
    min-height: 140px;
  }

  .mode-card:hover {
    border-color: #4f46e5;
    box-shadow: 0 4px 16px rgba(79, 70, 229, 0.1);
    transform: translateY(-2px);
  }

  .mode-card--soon {
    background: #fafafa;
  }

  .mode-card--soon:hover {
    border-color: #94a3b8;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  }

  .mode-card-top {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
  }

  .mode-card-note {
    font-size: 0.7rem;
    color: #94a3b8;
    font-style: italic;
    line-height: 1.4;
    flex: 1;
    min-width: 0;
  }

  .mode-card-label {
    font-size: 1rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 0.4rem;
    line-height: 1.3;
  }

  .mode-card--soon .mode-card-label {
    color: #475569;
  }

  .mode-card-tagline {
    font-size: 0.875rem;
    color: #64748b;
    line-height: 1.55;
    margin: 0;
    flex: 1;
  }

  .mode-card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #f1f5f9;
  }

  .mode-card-phase {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #94a3b8;
  }

  .mode-card-arrow {
    font-size: 0.875rem;
    color: #4f46e5;
    opacity: 0;
    transition: opacity 0.15s ease, transform 0.15s ease;
    transform: translateX(-4px);
  }

  .mode-card:hover .mode-card-arrow {
    opacity: 1;
    transform: translateX(0);
  }

  .mode-card--soon .mode-card-arrow {
    color: #94a3b8;
  }

  .lens-categories {
    display: flex;
    flex-direction: column;
    gap: 2.25rem;
  }

  .lens-category-label {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #94a3b8;
    margin: 0 0 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #f1f5f9;
  }

  .toolkit-cta {
    margin-top: 4rem;
    padding-top: 2.5rem;
    border-top: 2px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 1.25rem;
    flex-wrap: wrap;
  }

  .toolkit-cta p {
    font-size: 1rem;
    font-weight: 600;
    color: #475569;
    margin: 0;
  }

  @media (max-width: 640px) {
    .toolkit-title { font-size: 1.875rem; }
    .cards-grid { grid-template-columns: 1fr; }
    .bucket-nav { gap: 0.375rem; }
    .bucket-nav-pill { font-size: 0.75rem; padding: 0.3rem 0.75rem; }
  }
</style>
