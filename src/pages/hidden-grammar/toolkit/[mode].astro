---
import HiddenGrammarLayout from '../../../layouts/HiddenGrammarLayout.astro';
import { allModes, getModeById } from '../../../data/toolkit-modes.js';

export async function getStaticPaths() {
  return allModes.map((mode: any) => ({
    params: { mode: mode.id },
  }));
}

const { mode: modeId } = Astro.params;
const mode = getModeById(modeId) as any;

if (!mode) {
  return Astro.redirect('/hidden-grammar/toolkit');
}

const isLive = mode.status === 'live';
const analyzerLink = mode.link || '/hidden-grammar/ai-analyze';
const modeNote = mode.note || null;
const modeDetail = mode.detail || null;
---

<HiddenGrammarLayout title={`${mode.label} — Art Lab Toolkit`}>
  <div class="detail-page">

    <!-- ── BREADCRUMB ─────────────────────────────────────────── -->
    <nav class="hg-breadcrumb" aria-label="Breadcrumb">
      <a href="/hidden-grammar">Art Lab</a>
      <span class="hg-breadcrumb-sep">›</span>
      <a href="/hidden-grammar/toolkit">Toolkit</a>
      <span class="hg-breadcrumb-sep">›</span>
      <span>{mode.label}</span>
    </nav>

    <!-- ── HEADER ────────────────────────────────────────────── -->
    <header class="detail-header">
      <div class="detail-header-meta">
        <span class={`badge ${isLive ? 'badge--live' : 'badge--soon'}`}>
          {isLive ? 'Live' : 'Coming soon'}
        </span>
        <span class="detail-phase">{mode.phase}</span>
        <span class="detail-bucket">{mode.bucketLabel}</span>
      </div>
      <h1 class="detail-title">{mode.label}</h1>
      <p class="detail-tagline">{mode.tagline}</p>

      {isLive ? (
        <div class="detail-cta">
          <a href={analyzerLink} class="hg-btn hg-btn--primary">
            Open in AI Analyzer →
          </a>
        </div>
      ) : (
        <div class="detail-cta">
          <span class="detail-coming-soon-msg">
            This tool is in development. Check back soon.
          </span>
          <a href="/hidden-grammar/toolkit" class="hg-btn hg-btn--ghost">
            ← Back to Toolkit
          </a>
        </div>
      )}
    </header>

    <!-- ── NOTE ──────────────────────────────────────────────── -->
    {modeNote && (
      <div class="detail-note">
        <span class="detail-note-icon">ℹ</span>
        {modeNote}
      </div>
    )}

    <!-- ── DETAIL CONTENT ────────────────────────────────────── -->
    {modeDetail && (
      <div class="detail-content">

        <section class="detail-section">
          <h2 class="detail-section-title">What it does</h2>
          <p class="detail-section-body">{modeDetail.what}</p>
        </section>

        {modeDetail.when && modeDetail.when.length > 0 && (
          <section class="detail-section">
            <h2 class="detail-section-title">When to use it</h2>
            <ul class="detail-list">
              {modeDetail.when.map((item: string) => (
                <li>{item}</li>
              ))}
            </ul>
          </section>
        )}

        <section class="detail-section">
          <h2 class="detail-section-title">What you get back</h2>
          <p class="detail-section-body">{modeDetail.output}</p>
        </section>

        {modeDetail.constraints && (
          <section class="detail-section detail-section--constraint">
            <h2 class="detail-section-title">Framework constraints</h2>
            <p class="detail-section-body">{modeDetail.constraints}</p>
          </section>
        )}

      </div>
    )}

    {!modeDetail && (
      <div class="detail-placeholder">
        <p>Full documentation for this mode is being written.</p>
        <p>The tagline above is the short version of what it does.</p>
      </div>
    )}

    <!-- ── BOTTOM NAV ─────────────────────────────────────────── -->
    <div class="detail-bottom-nav">
      <a href="/hidden-grammar/toolkit" class="hg-btn hg-btn--ghost">
        ← All tools
      </a>
      {isLive && (
        <a href={analyzerLink} class="hg-btn hg-btn--primary">
          Open in AI Analyzer →
        </a>
      )}
    </div>

  </div>
</HiddenGrammarLayout>

<style>
  .detail-page {
    max-width: 760px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  .detail-header {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid #e2e8f0;
  }

  .detail-header-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 0.75rem;
  }

  .badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 0.2rem 0.55rem;
    border-radius: 4px;
    white-space: nowrap;
  }

  .badge--live { background: #dcfce7; color: #166534; }
  .badge--soon { background: #f1f5f9; color: #64748b; }

  .detail-phase,
  .detail-bucket {
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #94a3b8;
  }

  .detail-phase::before,
  .detail-bucket::before {
    content: '·';
    margin-right: 0.5rem;
  }

  .detail-title {
    font-size: 2rem;
    font-weight: 800;
    color: #0f172a;
    margin: 0 0 0.6rem;
    line-height: 1.2;
  }

  .detail-tagline {
    font-size: 1.0625rem;
    color: #475569;
    line-height: 1.6;
    margin: 0 0 1.5rem;
    font-style: italic;
  }

  .detail-cta {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .detail-coming-soon-msg {
    font-size: 0.875rem;
    color: #94a3b8;
    font-style: italic;
  }

  .detail-note {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    background: #fffbeb;
    border: 1px solid #fcd34d;
    border-radius: 8px;
    padding: 0.875rem 1rem;
    font-size: 0.875rem;
    color: #78350f;
    margin-bottom: 2rem;
    line-height: 1.55;
  }

  .detail-note-icon {
    font-size: 0.875rem;
    flex-shrink: 0;
    margin-top: 0.05rem;
  }

  .detail-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .detail-section {
    padding-bottom: 2rem;
    border-bottom: 1px solid #f1f5f9;
  }

  .detail-section:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .detail-section-title {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #4f46e5;
    margin: 0 0 0.75rem;
  }

  .detail-section-body {
    font-size: 0.9375rem;
    color: #334155;
    line-height: 1.7;
    margin: 0;
  }

  .detail-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .detail-list li {
    font-size: 0.9375rem;
    color: #334155;
    line-height: 1.6;
    padding: 0.5rem 0.75rem;
    background: #f8fafc;
    border-left: 3px solid #4f46e5;
    border-radius: 4px;
  }

  .detail-section--constraint {
    background: #fafaf9;
    padding: 1.25rem;
    border-radius: 8px;
    border: 1px solid #e7e5e4;
    border-bottom: 1px solid #e7e5e4;
  }

  .detail-section--constraint .detail-section-title { color: #78350f; }
  .detail-section--constraint .detail-section-body { color: #57534e; }

  .detail-placeholder {
    background: #f8fafc;
    border: 1.5px dashed #cbd5e1;
    border-radius: 10px;
    padding: 2rem;
    text-align: center;
    color: #94a3b8;
    font-size: 0.9375rem;
    line-height: 1.6;
  }

  .detail-placeholder p { margin: 0 0 0.5rem; }
  .detail-placeholder p:last-child { margin: 0; }

  .detail-bottom-nav {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 2px solid #e2e8f0;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  @media (max-width: 640px) {
    .detail-title { font-size: 1.625rem; }
    .detail-bottom-nav { flex-direction: column; }
  }
</style>
