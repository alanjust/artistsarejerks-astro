---
import BaseLayout from '../../layouts/BaseLayout.astro';
import principles from '../../data/hg-principles.json';

const tierAPrinciples = principles.principles.filter(p => p.tier === 'A');
const tierBPrinciples = principles.principles.filter(p => p.tier === 'B');
const tierCPrinciples = principles.principles.filter(p => p.tier === 'C');
const tierDPrinciples = principles.principles.filter(p => p.tier === 'D');
---

<BaseLayout title="The 46 Principles - Hidden Grammar" description="Browse the perceptual mechanisms that guide how art is experienced">
  <div class="principles-page">
    <header class="page-header">
      <h1>The 46 Principles</h1>
      <p class="tagline">Perceptual Mechanisms: How Vision Actually Works</p>
    </header>

    <div class="intro-section">
      <p>
        The 46 Art Principles are <strong>perceptual and neural mechanisms</strong> that influence what gets noticed,
        how forms organize, and how space is inferredâ€”all before conscious interpretation. They describe mechanisms
        that tend to influence visual perception, but <strong>they do not determine meaning</strong>.
      </p>

      <div class="epistemic-notice">
        <h3>Epistemic Notice</h3>
        <p>These principles describe mechanisms that tend to influence:</p>
        <ul>
          <li>what gets noticed first</li>
          <li>how forms group, separate, and stabilize</li>
          <li>how depth, surface, and motion cues cohere</li>
          <li>how visual tension and resolution can be felt</li>
        </ul>
        <p>Meaning is negotiated between the work, the viewer's prior knowledge and mood, and the surrounding context.</p>
      </div>

      <div class="tiers-explanation">
        <h3>Evidence Tiers</h3>
        <div class="tier-grid">
          <div class="tier-card tier-a">
            <strong>Tier A</strong>
            <p>{principles.meta.tiers.A}</p>
            <span class="count">{tierAPrinciples.length} principles</span>
          </div>
          <div class="tier-card tier-b">
            <strong>Tier B</strong>
            <p>{principles.meta.tiers.B}</p>
            <span class="count">{tierBPrinciples.length} principles</span>
          </div>
          <div class="tier-card tier-c">
            <strong>Tier C</strong>
            <p>{principles.meta.tiers.C}</p>
            <span class="count">{tierCPrinciples.length} principles</span>
          </div>
          <div class="tier-card tier-d">
            <strong>Tier D</strong>
            <p>{principles.meta.tiers.D}</p>
            <span class="count">{tierDPrinciples.length} principle</span>
          </div>
        </div>
      </div>
    </div>

    <div class="filter-controls">
      <button class="filter-btn active" data-tier="all">All Principles</button>
      <button class="filter-btn" data-tier="A">Tier A ({tierAPrinciples.length})</button>
      <button class="filter-btn" data-tier="B">Tier B ({tierBPrinciples.length})</button>
      <button class="filter-btn" data-tier="C">Tier C ({tierCPrinciples.length})</button>
      <button class="filter-btn" data-tier="D">Tier D ({tierDPrinciples.length})</button>
    </div>

    <div class="principles-container">
      <!-- Tier A Principles -->
      <section class="tier-section" data-tier="A">
        <h2 class="tier-heading">
          <span class="tier-badge tier-a">Tier A</span>
          Strong Perceptual / Early-Vision Biases
        </h2>
        <div class="principles-grid">
          {tierAPrinciples.map((principle) => (
            <article class="principle-card" data-tier="A">
              <div class="principle-header">
                <span class="principle-number">#{principle.id}</span>
                <div class="principle-title">
                  <h3>{principle.name}</h3>
                  <p class="principle-subtitle">{principle.subtitle}</p>
                </div>
              </div>

              {principle.neuralFact && (
                <div class="principle-detail">
                  <h4>Neural Fact</h4>
                  <p>{principle.neuralFact}</p>
                </div>
              )}

              {principle.studioTool && (
                <div class="principle-detail">
                  <h4>Studio Tool</h4>
                  <p>{principle.studioTool}</p>
                </div>
              )}

              {principle.edgeTypes && (
                <div class="principle-detail">
                  <h4>Edge Types</h4>
                  <ul class="edge-types">
                    {principle.edgeTypes.map((edge) => (
                      <li>
                        <strong>{edge.type}:</strong> {edge.effect}
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              {principle.gestaltPrinciples && (
                <div class="principle-detail">
                  <h4>Gestalt Principles</h4>
                  <ul class="gestalt-list">
                    {principle.gestaltPrinciples.map((gp) => (
                      <li>{gp}</li>
                    ))}
                  </ul>
                </div>
              )}

              {principle.options && (
                <div class="principle-detail">
                  <ul class="options-list">
                    {principle.options.map((opt) => (
                      <li>{opt}</li>
                    ))}
                  </ul>
                </div>
              )}

              {principle.studioUse && (
                <div class="studio-use">
                  <strong>Studio Use:</strong> {principle.studioUse}
                </div>
              )}
            </article>
          ))}
        </div>
      </section>

      <!-- Tier B Principles -->
      <section class="tier-section" data-tier="B">
        <h2 class="tier-heading">
          <span class="tier-badge tier-b">Tier B</span>
          Mid-Level Organization / Studio Heuristics
        </h2>
        <div class="principles-grid">
          {tierBPrinciples.map((principle) => (
            <article class="principle-card" data-tier="B">
              <div class="principle-header">
                <span class="principle-number">#{principle.id}</span>
                <div class="principle-title">
                  <h3>{principle.name}</h3>
                  <p class="principle-subtitle">{principle.subtitle}</p>
                </div>
              </div>

              {principle.neuralFact && (
                <div class="principle-detail">
                  <h4>Neural Fact</h4>
                  <p>{principle.neuralFact}</p>
                </div>
              )}

              {principle.studioTool && (
                <div class="principle-detail">
                  <h4>Studio Tool</h4>
                  <p>{principle.studioTool}</p>
                </div>
              )}

              {principle.studioUse && (
                <div class="studio-use">
                  <strong>Studio Use:</strong> {principle.studioUse}
                </div>
              )}
            </article>
          ))}
        </div>
      </section>

      <!-- Tier C Principles -->
      <section class="tier-section" data-tier="C">
        <h2 class="tier-heading">
          <span class="tier-badge tier-c">Tier C</span>
          Cognitive/Affective or Cultural Association
        </h2>
        <div class="principles-grid">
          {tierCPrinciples.map((principle) => (
            <article class="principle-card" data-tier="C">
              <div class="principle-header">
                <span class="principle-number">#{principle.id}</span>
                <div class="principle-title">
                  <h3>{principle.name}</h3>
                  <p class="principle-subtitle">{principle.subtitle}</p>
                </div>
              </div>
            </article>
          ))}
        </div>
      </section>

      <!-- Tier D Principles -->
      <section class="tier-section" data-tier="D">
        <h2 class="tier-heading">
          <span class="tier-badge tier-d">Tier D</span>
          Design System / Heuristic
        </h2>
        <div class="principles-grid">
          {tierDPrinciples.map((principle) => (
            <article class="principle-card" data-tier="D">
              <div class="principle-header">
                <span class="principle-number">#{principle.id}</span>
                <div class="principle-title">
                  <h3>{principle.name}</h3>
                  <p class="principle-subtitle">{principle.subtitle}</p>
                </div>
              </div>
            </article>
          ))}
        </div>
      </section>
    </div>
  </div>
</BaseLayout>

<script>
  // Filter functionality
  const filterBtns = document.querySelectorAll('.filter-btn');
  const tierSections = document.querySelectorAll('.tier-section');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const tier = btn.dataset.tier;

      // Update active button
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Show/hide sections
      if (tier === 'all') {
        tierSections.forEach(section => {
          section.style.display = 'block';
        });
      } else {
        tierSections.forEach(section => {
          if (section.dataset.tier === tier) {
            section.style.display = 'block';
          } else {
            section.style.display = 'none';
          }
        });
      }
    });
  });
</script>

<style>
  .principles-page {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--space-xl) var(--space-m);
  }

  .page-header {
    text-align: center;
    margin-bottom: var(--space-2xl);
    padding-bottom: var(--space-xl);
    border-bottom: 3px solid var(--color-orange);
  }

  .page-header h1 {
    font-family: var(--font-display);
    font-size: var(--text-5xl);
    color: var(--color-orange);
    margin-bottom: var(--space-s);
  }

  .tagline {
    font-size: var(--text-xl);
    color: var(--color-gray-6);
  }

  .intro-section {
    background: var(--color-cream);
    padding: var(--space-xl);
    border-radius: 12px;
    margin-bottom: var(--space-3xl);
    line-height: 1.7;
  }

  .intro-section > p {
    margin-bottom: var(--space-l);
  }

  .epistemic-notice {
    background: var(--color-white);
    padding: var(--space-l);
    border-left: 4px solid var(--color-purple);
    border-radius: 6px;
    margin-bottom: var(--space-l);
  }

  .epistemic-notice h3 {
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    color: var(--color-purple);
    margin-bottom: var(--space-m);
  }

  .epistemic-notice ul {
    margin: var(--space-m) 0;
    padding-left: var(--space-l);
  }

  .epistemic-notice li {
    margin-bottom: var(--space-xs);
  }

  .tiers-explanation h3 {
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    color: var(--color-purple);
    margin-bottom: var(--space-m);
  }

  .tier-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-m);
  }

  .tier-card {
    background: var(--color-white);
    padding: var(--space-l);
    border-radius: 8px;
    border-left: 4px solid;
  }

  .tier-card.tier-a {
    border-color: var(--color-green);
  }

  .tier-card.tier-b {
    border-color: var(--color-blue);
  }

  .tier-card.tier-c {
    border-color: var(--color-orange);
  }

  .tier-card.tier-d {
    border-color: var(--color-gray-5);
  }

  .tier-card strong {
    display: block;
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    margin-bottom: var(--space-s);
    color: var(--color-purple);
  }

  .tier-card p {
    font-size: var(--text-sm);
    color: var(--color-gray-7);
    margin-bottom: var(--space-s);
  }

  .tier-card .count {
    display: block;
    font-size: var(--text-xs);
    color: var(--color-gray-6);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .filter-controls {
    display: flex;
    gap: var(--space-s);
    margin-bottom: var(--space-2xl);
    flex-wrap: wrap;
    justify-content: center;
  }

  .filter-btn {
    padding: var(--space-s) var(--space-l);
    border: 2px solid var(--color-gray-4);
    background: var(--color-white);
    color: var(--color-gray-7);
    border-radius: 6px;
    font-family: var(--font-body);
    font-size: var(--text-base);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-btn:hover {
    border-color: var(--color-purple);
    color: var(--color-purple);
  }

  .filter-btn.active {
    background: var(--color-purple);
    color: var(--color-white);
    border-color: var(--color-purple);
  }

  .principles-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-3xl);
  }

  .tier-section {
    scroll-margin-top: var(--space-xl);
  }

  .tier-heading {
    font-family: var(--font-heading);
    font-size: var(--text-2xl);
    color: var(--color-purple);
    margin-bottom: var(--space-xl);
    display: flex;
    align-items: center;
    gap: var(--space-m);
  }

  .tier-badge {
    display: inline-block;
    padding: var(--space-xs) var(--space-m);
    border-radius: 6px;
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--color-white);
  }

  .tier-badge.tier-a {
    background: var(--color-green);
  }

  .tier-badge.tier-b {
    background: var(--color-blue);
  }

  .tier-badge.tier-c {
    background: var(--color-orange);
  }

  .tier-badge.tier-d {
    background: var(--color-gray-5);
  }

  .principles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--space-l);
  }

  .principle-card {
    background: var(--color-white);
    border: 2px solid var(--color-gray-3);
    border-radius: 8px;
    padding: var(--space-l);
    transition: all 0.2s;
  }

  .principle-card:hover {
    border-color: var(--color-orange);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .principle-header {
    display: flex;
    gap: var(--space-m);
    margin-bottom: var(--space-m);
    padding-bottom: var(--space-m);
    border-bottom: 2px solid var(--color-gray-2);
  }

  .principle-number {
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--color-orange);
    flex-shrink: 0;
  }

  .principle-title {
    flex: 1;
  }

  .principle-title h3 {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    color: var(--color-purple);
    margin: 0 0 var(--space-xs) 0;
  }

  .principle-subtitle {
    font-size: var(--text-sm);
    color: var(--color-gray-6);
    margin: 0;
  }

  .principle-detail {
    margin-bottom: var(--space-m);
  }

  .principle-detail h4 {
    font-family: var(--font-heading);
    font-size: var(--text-base);
    color: var(--color-gray-8);
    margin-bottom: var(--space-xs);
  }

  .principle-detail p {
    font-size: var(--text-sm);
    line-height: 1.6;
    color: var(--color-gray-7);
  }

  .principle-detail ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .principle-detail li {
    font-size: var(--text-sm);
    padding: var(--space-xs) 0;
    border-bottom: 1px solid var(--color-gray-2);
    color: var(--color-gray-7);
  }

  .principle-detail li:last-child {
    border-bottom: none;
  }

  .edge-types li,
  .gestalt-list li {
    padding: var(--space-xs) var(--space-s);
    background: var(--color-cream);
    border-left: 3px solid var(--color-purple);
    border-bottom: none;
    margin-bottom: var(--space-xs);
    border-radius: 4px;
  }

  .studio-use {
    background: var(--color-cream);
    padding: var(--space-m);
    border-radius: 6px;
    font-size: var(--text-sm);
    margin-top: var(--space-m);
  }

  .studio-use strong {
    color: var(--color-purple);
  }

  @media (max-width: 768px) {
    .page-header h1 {
      font-size: var(--text-4xl);
    }

    .tier-grid {
      grid-template-columns: 1fr;
    }

    .principles-grid {
      grid-template-columns: 1fr;
    }

    .filter-controls {
      justify-content: stretch;
    }

    .filter-btn {
      flex: 1;
      min-width: 100px;
    }
  }
</style>
